# Use Ubuntu as the base
FROM ubuntu:24.04

# Install dependencies, Docker GPG keys, and IPTables
RUN apt-get update && apt-get install -y \
	ca-certificates \
	curl \
	gnupg \
	lsb-release \
	iptables

# Add Docker's official GPG key and repository
RUN install -m 0755 -d /etc/apt/keyrings && \
	curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg && \
	chmod a+r /etc/apt/keyrings/docker.gpg

RUN echo \
	"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
	$(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
	tee /etc/apt/sources.list.d/docker.list > /dev/null

# Install Docker Engine (docker-ce)
RUN apt-get update && apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

VOLUME ["/var/lib/docker"]

# Directly run the Docker Daemon in the foreground
# This keeps the container running indefinitely
CMD ["dockerd"]
